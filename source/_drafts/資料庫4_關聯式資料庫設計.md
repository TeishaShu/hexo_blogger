---
title: 資料庫(4) - 關聯式資料庫設計
tags: 資料庫
categories: 資料庫
---

<!--more-->


### 關聯式資料庫 Relational Model Concepts
- 資料型態: 二維表格
- 特色: 簡單易懂、直覺，有數學理論支持

每個關聯(表格)包含很多列(Row)與欄(Column)
下表前3項容易混用

| 非正式術語          | 正式術語     |
|---------------------|--------------|
| 表格 Table          | 關聯 Relation |
| 欄位(表頭) Field    | 屬性 Attribute|
| 列 Row(Row Data 一筆資料)、紀錄 Record | 值組 Tuple    | 
| 欄位中的資料範圍    | 定義域 Domain | 
| 對表格的定義        | 關聯綱要 The "schema" of relation | 

- 一個關聯(表格)階度(Degree): 此關聯的屬性個數。
- 表頭(Heading): 有一定數量的屬性集合、各屬性有相關的定義域(Domain)來表示資料的特徵。
- 主體(Body): 很多 Tuple 組成，會隨時間變動。

- 定義域 Domain:
相關表頭存資料的最大、最小範圍。
ex:Age->0~99歲、台灣姓名->char(10) 10個字元長度內。

### 關聯的特性 Characteristics Of Relations
- Tuple 之間沒有次序性(Order)
資料看到有排序是後來用的，表格中不在乎次序
- Attribute: 
  1. 表頭位置之間沒有次序性(Order)
  2. 每個值都是基元值(Atomic Value).又稱簡單值(Simple Value)、純量值(Scalar Value)
  由 User 認定存放的值無法繼續拆開。(有些很明確，有些需要看公司狀況要不要拆解)
  ex:性別:男女(男無法在拆解)。生日:通常年月日存在一起，但有些公司需要個別拆開。姓名:姓氏需不需要獨立存放也是看公司需不需要。
- 一個關聯中，不會有完全重複的 Tuple

### 空值 Null Value
- 目前不詳的資料，後續運算會有特殊處理。
空白不是存空白鍵或零的值，是該欄完全沒有填入任何資料。
- 3種意義:影響使用值的後續處理
  - 可應用的空值(Application null value):資料還沒填，不用特別處哩，只要提醒使用者記得填寫。
  - 不可應用的空值(Inapplicable null value):真的不存在。後續也無法處理
  - 完全未知的空值(Unknown null value): 不知道有沒有存在，要積極去追會變成前2種的意義。

### 鍵值 Key Value (**很重要)
(超鍵>候選鍵>主鍵)

- 超鍵(Super Key): 
什麼屬性集合在一起"可以做資料的唯一識別"。
-具有唯一識別性。
ex:透過唯一值把要的資料找出來(身分證、學號、id...)。
-最小的超鍵由一個屬性找到，最大的超鍵所有屬性集合(不可能有一模一樣的資料，也是唯一識別)。
-有時候超鍵會包刮不需要的多於屬性。

- 候選鍵(Candidate Key):
-唯一性:最少屬性集合的超鍵。
也是最小性(Minimality)、不可縮減性(Irreducibility)
-屬性是唯一值(這些是候選)，代表這些可以挑一個。
當選的是主鍵，其他是替代鍵。
-不可縮減性:一個表格，想要一筆資料需2個以上屬性，少一個都無法找到要的資料(ex:姓名、生日、戶籍地。姓名、生日、監護人)

- 主鍵(Primary Key)
-多個候選鍵挑選時，作業上較常用到、最方便、最短的當主鍵。(多個屬性實:1個主鍵會有多個屬性構成)
-標示方式:標頭的那個屬性，會有下"實底線"
-主鍵絕對不能有任一個欄位存空值(Null Value)
-*一個二維表格只能有一個主鍵，構成欄位可以1或多個

- 替代鍵(Alternate Key)
除了主鍵的其他候選鍵。
主鍵意外有狀況可以替代。
一般欄位的替代，"盡量"不能重複、存空值

- 外來鍵(Foreign Key)
-主要功能-參考完整性限制:維護表格之間的資料一致性，"建立連動關係"
-屬性名稱下方畫"虛底線"
-2個表格中，在1表格中的一個或多個屬性，這屬性在2表格是主鍵。
ex:表格1-人才基本資料(姓名、血型、星座)，表格2-星座表格(星座是主鍵)
-外來鍵不用唯一性，但是當主鍵一定要有資料。
-一張表格可以有很多外來鍵。

---------------------------------------------------------------------------
### 限制條件設定 Relational Model Constraints
設定限制可以建立規則比較沒有問題
*看主要的限制對象是誰。

#### Integrity Constraint(完整性限制)
- Entity integrity constraint 個體完整性限制
-主要限制對象: 主鍵(Primary Key)
-主鍵「不能空值、重複資料出現」，因為目的是用來識別特定的資料。

- Referential integrity constraint 參考完整性限制
用來貫穿更多表格又達到一致性
-主要限制對象: 外來鍵(Foreign Key)
-外來鍵可以空值，有值的話要相匹配(Match)到他自己的主鍵關聯表格。

#### Domain Constraint(定義域限制)
有時被歸類在定義域完整性限制 Domain Integrity Constraint。
-主要限制對象: 關聯中每個屬性(Attribute)
-每個屬性要滿足2限制:
  a.定義域範圍:資料型態設定後就要訂了(ex:名字.設定最多幾字元)
  b.基元值(Atomic Value):設定2維表格就要訂了.不能在拆解

### 資料操作與違反限制之情況
#### 最常使用的操作:
- Insert(插入): insert "a new tuple" or "tuples" in a relation.
- Delete(刪除): delete tuples
- Update(更新、Modify): "change the values" of some attributes in existing tuples.

3種操作不管怎麼用，都要符合前面提到的各種限制。
-Insert、Update 可能會違反各項(ex:主鍵的限制-不能重複、空值。外來鍵在自己的主鍵表格有沒有存在)。
-Delete只可能違反參考完整性限制(ex:刪除外來鍵的項目)。
如果其他表格沒有使用可以刪，有被參考到可以採取3種方法:
  a.限制(Restricted): 有被其他表格參考到，絕對不讓你刪除。
  b.連帶(Cascade): 其他參考到的資料，同時刪除參考到的資料(整筆消失)。資方的角色合理(ex:裁員整個部門)
  c.空值化(Nullify): 其他參考到的資料，那格外來鍵變成空值，其他資料還留著

-Update範例:
  a.限制(Restricted): 不允許更新
  b.連帶(Cascade): 其他參考到的外來鍵資料一起更新
  c.空值化(Nullify): 其他參考到的外來鍵變成空值(等待被更新)