---
title: 前端測試(1) - 為何要寫測試
tags: 測試
categories: 測試
---
Jest 單元測試框架是 Facebook 推出。

### 為何要寫測試?
- 維護、重構時，改動其他部分不小心更動到某個數值，導致結果錯誤。(改A壞B的情況)
因此如果有寫測試，就可以安心的改動，因為只要有錯就會顯示。
- 維護、進行敏捷開發過程中，產品不斷迭代，可以透過寫測試增加開發速度，因為發開完團隊、自己都需要花時間測試。
- 重構: 隨著專案的進展，程式越來越複雜，程式如果越來越爛，開發也會越來越慢，導致更多 bug
- 減少維護成本: 很多公司耗用大量人力、金錢進行網站維護

<!--more-->
### 測試種類
大部分公司沒有測試工程師，思考實際上想要測什麼，不同測試類型需要保護的面向不太相同。

#### 單元測試 Unit Text
針對程式最小單位進行測試。ex:funtion。

想確保細部的商業邏輯正確適合使用。
通常由開發人員自行撰寫，不用另外設立環境。
成本比較低，測 funtion 尤其是整理資料區塊，有時候比較難切出單一 funciton，就只能跑 E2E 確定頁面都可以載入、一般的操作都不會出錯。
有些公司會為了申請 ISO 要達到一定的覆蓋率 就會寫比較多測試。

使用工具: Jest

#### 整合測試 Integration Test

#### 端對端測試 End-to-End Test
模擬真實使用者測試整個專案的功能和流程。
ex: 登入、註冊...。

成本比較高較花時間: 跑的比較久（可能10分鐘以上）。
考慮成本: 如果花一個禮拜寫 E2E（40小時），每次跑10分鐘，跟目前一個禮拜手動測試一次10分鐘，可能要兩三個月後才會回本，可以衡量值不值得投資。

使用工具: Cypress(這個難測拖拉的狀況)、Playwright、Selenium(比較老牌.穩，但是一開始安裝流程比較多)


### 寫測試的時機:
目標:保護程式
因此不是所有元件都需要寫測試，首先需要評估這段程式的重要性
ex: 必須很強迫限制參數類型，不能有誤傳的狀況

因為寫測試也是需要時間來開發，但如果花1.5~2倍的時間開發，未來長期下來可以減少不只2倍

<!-- ### 學習歷程
1. 了解為何要做測試
2. Jest 單元測試
3. 元件化 UI 測試
4. 狀態管理測試 -->

### 特色: 
1. 速度很快
2. Opinionated: 零配置的前端測試工具，可以直接啟用
3. Watch Mode: 注重開發者體驗，開發時透過測試快速獲得測試結果。
4. Snapshot Testing: 實例上，需要看適合的情境使用，有時候不太適合。

Cypress是end to end測試才用，如果是一般unit test的話用jest。


https://ithelp.ithome.com.tw/articles/10276404

-------------------------------------------------------------------------------
### 安裝
1. 安裝 Jest
```
npm install --save-dev jest

// ts版本 
npm install --save-dev ts-jest
```

2. package.json 配置文件
```
{
  "scripts": {
    "test": "jest",
    "test:watch":"jest --watchAll",
  }
}
```

3. 執行
```
npm run test 

// 或使用 watch
npm run test:watch 
```

4. 建立測試檔案.測試看看
sum.test.js，使用 typeScript 則是 sum.test.tsx
```
const sum = require('./sum');

test('adds 1 + 2 to equal 3', () => {
  expect(sum(1, 2)).toBe(3);
});
```

### 預備
1. vscode 安裝 Jest 輔助
2. 測試檔案位置: 在外層開一個 Test 資料夾，或是在要測試的檔案旁邊增加一個test檔案
(xxxx.test.js，使用 typeScript 則是 xxxx.test.tsx)
3. 檔案中.先初始化，讓資料乾淨不要用跑過的資料
```
beforeEach(()=>{
  xxx = 預設資料
})
```

### 語法
一次測試一個 function，測試內容會放很多情境的測試狀況。
```
describe("sum", ()=>{
  test("自定義名稱",()=>{
    expect(sum(1,2)).toBe("期待結果") //純值使用 toBe
    // expect(sum(1,2)).toEqual("期待結果") //物件使用 toEqual
  })
})
```

範例
```
describe("sum", ()=>{
  test("1+1",()=>{
    expect(sum(1,2)).toBe(2)
  })
  test("3-61",()=>{
    expect(sum(3,-61)).toBe(-58)
  })
})
```
