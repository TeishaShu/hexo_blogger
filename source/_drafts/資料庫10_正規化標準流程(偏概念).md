---
title: 資料庫(10) - 正規化標準流程(偏概念)
tags: 資料庫
categories: 資料庫
---
正規化的階層有很多架構，越嚴格資料表分割越細膩。
不是正規化越細膩越好，太多資料表可能查詢越困難，滿足需求就可以，通常滿足第3正規化(3NF)就可以用了，不會資料表太細操作上也還可以。
<!--more-->

### 目的
- 解決: 資料重複性、避免資料更新異常
- 方法: 根據不同相依性分割關聯
- 前提: 分割後的關聯不能有資訊遺失(無損失分解)

### 關鍵
功能性的相依
ex:學號為主，學生、姓名、監護人都有關係，監護人的電話跟監護人有關係，但是跟學號是傳遞性的功能相依。

### 功能相依性種類:
鍵值屬性 Key Attribute: 能構成主鍵或候選主鍵。

- 完全功能相依 Full Functional Dependency: 主鍵由1個屬性組成。
- 部分功能相依 Partial Functional Dependency: 主鍵由多欄位構成，容易發生部分功能相依
- 遞移相依 Transitive Dependency: 間接影響。ex:A->B->C。(A 影響 C)

### 正規化類型
以漸進式逐步表格分割，每一步滿足某一項正規化形式。
- 低階正規化:
  - 第一正規化 1NF; First Normal Form
  - 第二正規化 2NF; Second Normal Form
  - 第三正規化 3NF; Third Normal Form
  - BC 正規化 BCNF; Boyce-Codd Normal Form

- 高階正規化: 實務上超級很少用，但考試喜歡考
  - 第四正規化 4NF; Forth Normal Form
  - 第五正規化 5NF; Fifth Normal Form

#### 第一正規化 1NF
- 先做: 去除重複資料
- 表格特色: 欄位項目都是 Atomic Value(單元值、基元值)。
每個欄位的內容都是最小單位，不可在分割，如果需要分割再另外設計資料表的欄位。
ex: 張某某(09xxxxxxx)，會分成2個欄位名字、手機，不會存在同一欄。
- 違反狀況: 
  - 多值屬性: 一個欄位有很多值。把每筆都獨立，其他前面一樣的重複填寫 => 產生資料重複性問題
  - 複合屬性: 拆成簡單屬性。ex:欄位生日，公司希望把月、日拆開。

#### 第二正規化 2NF
- 先做: 去除部分功能相依性
- 表格特色: 符合第一正規化的特性外，「所有欄位都必須跟主鍵功能-完全相依」。

太多主鍵在一張表遇到的問題:
- 新增: 不相關欄位 null
- 編輯: 與主鍵無關的其他欄位修改，那欄位資料可能不同步導致無法管理
- 刪除: 刪除一筆資料，其他需要的地方找不到資料

因此一張表需要功能相依性，太多主鍵功能要開不同的表。
ex: 一張表的目的是: 學生個人資料，一張表是: 課程資料，都放在同一張表的化，資料的管理、整合性、彈性反而變差，應該要分2張表根據不同目的管理。

#### 第三正規化 3NF
- 先做: 去除遞移相依性
- 表格特色: 符合前2個正規化的特性外，沒有跟其他欄位相依，每一個非鍵屬性「非遞移相依」於主鍵。
(第二個是有相關，第三個是沒相關的不要放)

#### Boyce-Codd 正規化 BCNF
3NF的改良，比較嚴苛，一定符合 3NF
- 先做: 去除其他功能相依性引起的異常
- 表格特色: 
  1. 功能相依性的決定都是候選鍵
  2. 主鍵為單一屬性時，不用考慮沒有這狀況。

#### 第四正規化 4NF
- 先做: 去除多值相依性
- 表格特色: 符合前面特性外，沒有 Multivalued Dependency 現象

#### 第五正規化 5NF
- 先做: 去除合併相依性
- 表格特色: 又稱 Proiection-Join Normal Form; PJ/NF
幾乎不用(考試用)，表格合併會多奇怪的資料。

------------------------------------------
### 實務經驗
表格經正規化分割越細，理論上可以避免資料重複、更新上的異常，實務上會有下面問題:
1. 查詢上變得沒效率: 查詢需要用到許多合併(Join)運算。
ex:原本只要1張表格可以查詢到，變成要查很多表格撈資料結合在一起

2. 可能產生有損分解

=> 實作上為保持「執行效率 & 避免異常」，通常進行到 3NF，最多到 BCNF 即可。
避免異常: 正規化表格適度分解，同一個表格上不要同時有多個相依性，不同相依性有它的異常狀況，分解後回去看原本的功能(箭頭)是否存在。
(使用阿姆斯壯定理來確認，遇到有損時使用)

#### 阿姆斯壯定理
A、B、C、D 是4個任意屬性子集，AB表示A聯集B。
- 反身性 Reflexivity: 若 B 是 A 的子集合， A->B。
- 擴張性 Augmentation: 若 A->B，則 AC->BC。
- 遞移性 Transitivity: 若 A->B 且 B->C，則 A->C。
- 自身決定性 Self-determination: A->A。
- 分解性 Decomposition: 若 A->BC，則 A->B 且 A->C。
- 聯集性 Union: 若 A->B 且 A->C，則 A->BC。
- 合成性 Composition: 若 A->B 且 C->D，則 AC->BD。
- 虛擬遞移性 Pseudo-transitivity: 若 A->B 且 BC->D，則 AC->D。

#### 反正規化 De-normalization
正規化過程中，有時候會造成資料處理速度上效率的困擾，或表格分割造成的損失，因此有時候需要適當的反正規化。
必須小心控制，會造成資料重複性問題或更新上一些異常。